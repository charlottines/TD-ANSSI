{% extends "analyse/base.html" %}
{% block content %}

<div class="container mt-5" style="max-width: 600px;">
  <h2 class="text-center mb-4"> Déclencher une alerte critique par email</h2>

  <form method="POST" action="{% url 'trigger_alerts' %}">
    {% csrf_token %}

    <div class="mb-3">
      <label class="form-label fw-semibold"> Email expéditeur</label>
      <input type="email" class="form-control" name="from_email" placeholder="ex: monmail@gmail.com" required>
    </div>

    <div class="mb-3">
      <label class="form-label fw-semibold"> Mot de passe (mot de passe d'application Gmail)</label>
      <input type="password" class="form-control" name="password" placeholder="mot de passe Gmail" required>
    </div>

    <div class="mb-3">
      <label class="form-label fw-semibold"> Email destinataire</label>
      <input type="email" class="form-control" name="to_email" placeholder="destinataire@example.com" required>
    </div>

    <div class="mb-4">
      <label class="form-label fw-semibold"> Sujet du message</label>
      <input type="text" class="form-control" name="subject" value="Alerte critique" required>
    </div>

    <div class="text-center">
      <button type="submit" class="btn btn-danger btn-lg px-4 shadow">
         Déclencher les alertes
      </button>
    </div>
  </form>
</div>

<div class="text-center mt-3">
  <button type="button" class="btn btn-outline-secondary" onclick="stopEnvoi()">
     Arrêter l'envoi
  </button>
</div>

<script>
  function stopEnvoi() {
    fetch("/alerts/stop/", { method: "POST" })
      .then(() => alert(" L'envoi a été stoppé !"))
      .catch(() => alert(" Échec de l'arrêt."));
  }
</script>

{% endblock %}